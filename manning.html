<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Manning Schedule</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:linear-gradient(135deg,#00b894,#0984e3);
}

.navbar{
  position:relative;
  z-index:5;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  flex-wrap:wrap;
  padding:10px 20px;
  background:rgba(238, 237, 237, 0.35);
  backdrop-filter: blur(6px);
}
.navbar button{
  background:#74b9ff;
  border:none;
  padding:10px;
  border-radius:8px;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  flex:1;
  margin:3px;
}
.navbar button:hover{background:#0984e3}

.logo {
  height:90px; 
  margin-right:30px;
  cursor:pointer;
}
.section{
  background:#fff;
  margin:10px;
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);
  position:relative;
}

h2,h3{text-align:center}

#toggleTable{
  position:absolute;
  top:10px;
  left:10px;
  background:#0984e3;
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:5px;
  cursor:pointer;
}
#toggleTable:hover{background:#0652dd}

.month-control{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:15px;
  margin-bottom:15px;
}
.month-control button{
  background:#0984e3;
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:5px;
  cursor:pointer;
}
.month-control span{
  font-weight:bold;
  font-size:16px;
}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  margin-bottom:15px;
}
.calendar div{
  border:1px solid #ccc;
  min-height:60px;
  padding:4px;
  display:flex;
  flex-direction:column;
  align-items:center;
  background:#f9f9f9;
  border-radius:6px;
  box-shadow:0 1px 3px rgba(0,0,0,.1);
  font-size:13px;
}
.calendar div:hover{background:#e0f7fa}
.calendar strong{
  font-size:14px;
  margin-bottom:2px;
}
.calendar .note{
  flex:1;
  border-top:1px dashed #ccc;
  padding:2px;
  font-size:12px;
  overflow:auto;
  width:90%;
  min-height:20px;
  background:#fff;
  border-radius:4px;
  margin-top:2px;
  text-align:center;
}


#trackerTable{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
  display:none;
}
#trackerTable th, #trackerTable td{
  border:1px solid #aaa;
  padding:4px;
  text-align:center;
}
#trackerTable th{background:#f2f2f2}

input.editable{
  width:100%;
  border:none;
  background:transparent;
  text-align:center;
  font-size:13px;


button.action{
  background:#0984e3;
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:5px;
  cursor:pointer;
  margin-top:5px;
}
button.action:hover{background:#0652dd}

.calendar .day-header{
  font-weight:bold;
  text-align:center;
  padding:6px 0;
  background:#74b9ff;
  color:#fff;
  border-radius:4px;
}
</style>
</head>

<body>


<div class="navbar">
  <img src="VHBC.png" alt="VHBC Logo" class="logo" onclick="location.href='index.html'">
  <button onclick="location.href='index.html'">Home</button>
  <button onclick="location.href='report.html'">Report</button>
  <button onclick="location.href='tripping.html'">Tripping & Sales</button>
  <button onclick="location.href='manning.html'">Manning</button>
  <button onclick="location.href='activities.html'">Activities</button>
  <button onclick="location.href='lot-calculator.html'">Lot Calculator</button>
</div>

<div class="section">
  <h2>IN-HOUSE MANNING</h2>

 
  <button id="toggleTable" onclick="toggleTable()">Show Tracker</button>

  <div class="month-control">
    <button onclick="changeMonth(-1)">◀ Previous</button>
    <span id="monthLabel"></span>
    <button onclick="changeMonth(1)">Next ▶</button>
  </div>

  <div class="calendar" id="calendar"></div>

  <h3 id="trackerHeader" style="text-align:center; display:none;">IN-HOUSE MANNING</h3>
  <table id="trackerTable">
    <tr>
      <th>DATE</th>
      <th>ASSIGN MANNING</th>
      <th>DUTY</th>
      <th>STATUS</th>
      <th>TEAM ROTATION</th>
      <th>CLIENT NAME</th>
      <th>REMARKS</th>
    </tr>
  </table>

  <button class="action" onclick="addRow()">Add Row</button>
</div>

<script>
let currentDate = new Date();

function toggleTable(){
  const table = document.getElementById('trackerTable');
  const header = document.getElementById('trackerHeader');
  const btn = document.getElementById('toggleTable');
  if(table.style.display === "none"){
    table.style.display = "table";
    header.style.display = "block";
    btn.textContent = "Hide Tracker";
  } else {
    table.style.display = "none";
    header.style.display = "none";
    btn.textContent = "Show Tracker";
  }
}

function saveData(){
  const table = document.getElementById('trackerTable');
  const tableData = [];
  for(let r=1; r<table.rows.length; r++){ 
    const row = [];
    for(let c=0; c<table.rows[r].cells.length; c++){
      const input = table.rows[r].cells[c].querySelector('input');
      row.push(input ? input.value : '');
    }
    tableData.push(row);
  }
  localStorage.setItem('trackerTable', JSON.stringify(tableData));

  const notes = JSON.parse(localStorage.getItem('calendarNotes') || '{}');
  document.querySelectorAll('.calendar div.note-cell').forEach(div=>{
    const key = div.dataset.date;
    notes[key] = div.querySelector('.note').innerHTML;
  });
  localStorage.setItem('calendarNotes', JSON.stringify(notes));
}


function loadData(){

  const table = document.getElementById('trackerTable');
  const tableData = JSON.parse(localStorage.getItem('trackerTable') || '[]');
  while(table.rows.length > 1) table.deleteRow(1);

  tableData.forEach(rowData => {
    addRow(rowData);
  });


  const notes = JSON.parse(localStorage.getItem('calendarNotes')||'{}');
  document.querySelectorAll('.calendar div.note-cell').forEach(div=>{
    const key = div.dataset.date;
    if(notes[key]) div.querySelector('.note').innerHTML = notes[key];
  });
}

function addRow(values = []){
  const table = document.getElementById('trackerTable');
  const row = table.insertRow(-1);

  for(let i=0; i<7; i++){
    const cell = row.insertCell();
    const input = document.createElement('input');
    input.className = 'editable';
    input.value = values[i] || '';
    input.oninput = saveData; // save whenever input changes
    cell.appendChild(input);
  }

  saveData(); // save table after adding row
}

/* Restore input events for old rows (if needed) */
function restoreInputs(){
  document.querySelectorAll("input.editable").forEach(i=>{
    i.oninput = saveData;
  });
}


function buildCalendar(){
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  const monthName = currentDate.toLocaleString('default',{month:'long'});
  document.getElementById("monthLabel").textContent = `${monthName} ${year}`;

  // Days header
  const daysOfWeek = ["SUN","MON","TUE","WED","THU","FRI","SAT"];
  daysOfWeek.forEach(day=>{
    const div = document.createElement("div");
    div.className = "day-header";
    div.textContent = day;
    cal.appendChild(div);
  });

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();
  const notes = JSON.parse(localStorage.getItem('calendarNotes')||'{}');

  // Empty cells before first day
  for(let i=0; i<firstDay; i++){
    const emptyDiv = document.createElement("div");
    cal.appendChild(emptyDiv);
  }

  // Dates
  for(let d=1; d<=daysInMonth; d++){
    const div = document.createElement("div");
    div.className = "note-cell";
    const key = d + '-' + month + '-' + year; // unique key
    div.dataset.date = key;
    const noteContent = notes[key] || '';

    div.innerHTML = `
      <strong>${d}</strong>
      <div class="note" contenteditable="true">${noteContent}</div>
    `;

    // Save on input immediately
    div.querySelector('.note').addEventListener('input', saveData);
    cal.appendChild(div);
  }
}

/* MONTH CONTROL */
function changeMonth(step){
  currentDate.setMonth(currentDate.getMonth()+step);
  buildCalendar();
  loadData();
}

buildCalendar();
loadData();
</script>

</body>
</html>